<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>PDF Layout Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body {
            background: #111;
            color: white;
            padding: 20px;
        }

        #test-area {
            margin-bottom: 20px;
            border: 1px solid #444;
            padding: 10px;
        }
    </style>
</head>

<body>
    <h1>9Sec PDF Layout Test Runner</h1>
    <div id="test-area">
        <!-- The report will be injected here -->
    </div>
    <button id="run-test">Generate Mock PDF</button>

    <script>
        const mockData = {
            domain: "softnext.com.tw",
            risk_score: 95,
            dns_posture: {
                spf: "pass", spf_raw: "v=spf1 include:softnext.com.tw ~all",
                dmarc: "none", dmarc_raw: "v=DMARC1; p=none; rua=mailto:admin@softnext.com.tw",
                mta_sts: "missing", tls_rpt: "missing", dnssec: "fail", bimi: "missing"
            },
            smtp_tls: { version: "TLS 1.2" },
            sender_info: { mta: "Softnext Mail Server", transport_latency: "2.45 sec" },
            risk_breakdown: [
                { item: "DMARC policy is 'none' (Monitoring only)", score: 20, severity: "high" },
                { item: "DKIM Signature Missing in Email", score: 25, severity: "high" },
                { item: "MTA-STS Policy Missing", score: 10, severity: "medium" },
                { item: "BIMI Record Missing (No Brand Visuals)", score: 5, severity: "low" },
                { item: "DNSSEC not enabled on domain", score: 5, severity: "low" },
                { item: "Potential SPF Information Leak", score: 10, severity: "medium" },
                { item: "Insufficient MX Redundancy", score: 20, severity: "high" }
            ]
        };

        const getStatusClass = (val) => {
            const lower = String(val || '').toLowerCase();
            if (['pass', 'true', 'low', 'enforce', 'enabled'].includes(lower)) return 'pass';
            if (['warn', 'none', 'medium', 'missing', 'quarantine/none'].includes(lower)) return 'warn';
            return 'fail';
        };

        document.getElementById('run-test').addEventListener('click', () => {
            const domain = mockData.domain;
            const riskScore = mockData.risk_score;
            const dns = mockData.dns_posture;
            const data = mockData;

            const reportHtml = `
                <div class="pdf-page" style="background-color: #0a0a0a; color: #e0e0e0; font-family: 'Courier New', Courier, monospace; padding: 40px; width: 680px; min-height: 950px; border: 1px solid #333; margin-bottom: 20px;">
                    <div style="background-color: #0a0a0a; border-bottom: 2px solid #00ff41; padding-bottom: 15px; margin-bottom: 20px;">
                        <h1 style="color: #00ff41; margin: 0; font-size: 24px;">NINE-SECURITY // ASSESSMENT_LOG</h1>
                        <p style="margin: 8px 0 0; color: #888; font-size: 14px;">Target Domain: <span style="color: #00ff41;">\${domain}</span></p>
                        <p style="margin: 3px 0 0; color: #555; font-size: 11px;">Timestamp: \${new Date().toLocaleString()}</p>
                    </div>

                    <div style="background-color: #0a0a0a; color: #00ff41; margin-bottom: 15px; font-size: 16px;">> EXECUTIVE_RISK_PROFILE [Score: \${riskScore}/100]</div>
                    <div style="background-color: #0a0a0a; margin-bottom: 25px;">
                        \${(data.risk_breakdown || []).map(r => \`
                        <div style="background-color: #111; border: 1px solid #222; border-left: 5px solid \${r.severity === 'high' ? '#ff0055' : (r.severity === 'medium' ? '#ffaa00' : '#444')}; padding: 10px; margin-bottom: 6px;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <tr>
                                    <td style="color: #e0e0e0; font-size: 13px;">\${r.item}</td>
                                    <td style="text-align: right; color: #00ff41; font-weight: bold; font-size: 13px;">+\${r.score}</td>
                                </tr>
                            </table>
                        </div>
                        \`).join('')}
                    </div>

                    <div style="background-color: #0a0a0a; color: #00ff41; margin-bottom: 15px; font-size: 16px;">> AUTH_INFRASTRUCTURE_PROBE</div>
                    <table style="width: 100%; border-collapse: separate; border-spacing: 6px; background-color: #0a0a0a;">
                        <tr>
                            <td style="width: 50%; background-color: #111; border: 1px solid #222; padding: 12px; vertical-align: top;">
                                <div style="color: #666; font-size: 10px; text-transform: uppercase; margin-bottom: 4px;">Origin MTA</div>
                                <div style="font-size: 14px; font-weight: bold; color: #fff;">\${data.sender_info.mta || 'Generic MTA'}</div>
                            </td>
                            <td style="width: 50%; background-color: #111; border: 1px solid #222; padding: 12px; vertical-align: top;">
                                <div style="color: #666; font-size: 10px; text-transform: uppercase; margin-bottom: 4px;">Latency</div>
                                <div style="font-size: 14px; font-weight: bold; color: \${parseFloat(data.transport_time) > 5 ? '#ffaa00' : '#00ff41'}">\${data.transport_time || 'N/A'}</div>
                            </td>
                        </tr>
                        <tr>
                            <td style="width: 50%; background-color: #111; border: 1px solid #222; padding: 12px; vertical-align: top;">
                                <div style="color: #666; font-size: 10px; text-transform: uppercase; margin-bottom: 4px;">SPF Policy</div>
                                <div style="font-size: 14px; font-weight: bold; color: \${getStatusClass(dns.spf) === 'pass' ? '#00ff41' : '#ff0055'}">\${String(dns.spf || 'MISSING').toUpperCase()}</div>
                            </td>
                            <td style="width: 50%; background-color: #111; border: 1px solid #222; padding: 12px; vertical-align: top;">
                                <div style="color: #666; font-size: 10px; text-transform: uppercase; margin-bottom: 4px;">DMARC Status</div>
                                <div style="font-size: 14px; font-weight: bold; color: \${getStatusClass(dns.dmarc) === 'pass' ? '#00ff41' : '#ffaa00'}">\${String(dns.dmarc || 'NONE').toUpperCase()}</div>
                            </td>
                        </tr>
                    </table>
                </div>

                <div class="pdf-page" style="background-color: #0a0a0a; color: #e0e0e0; font-family: 'Courier New', Courier, monospace; padding: 40px; width: 680px; min-height: 950px; border: 1px solid #333; page-break-before: always; html2pdf-page-break-before: always;">
                    <div style="background-color: #0a0a0a; border-bottom: 2px solid #00ff41; padding-bottom: 10px; margin-bottom: 20px;">
                        <div style="color: #00ff41; font-size: 16px;">> ADVANCED_SECURITY_PROTOCOLS</div>
                    </div>

                    <table style="width: 100%; border-collapse: separate; border-spacing: 6px; background-color: #0a0a0a;">
                        <tr>
                            <td style="width: 50%; background-color: #111; border: 1px solid #222; padding: 12px; vertical-align: top;">
                                <div style="color: #666; font-size: 10px; text-transform: uppercase; margin-bottom: 4px;">MTA-STS Handshake</div>
                                <div style="font-size: 14px; font-weight: bold; color: \${getStatusClass(dns.mta_sts) === 'pass' ? '#00ff41' : '#ff0055'}">\${String(dns.mta_sts || 'MISSING').toUpperCase()}</div>
                            </td>
                            <td style="width: 50%; background-color: #111; border: 1px solid #222; padding: 12px; vertical-align: top;">
                                <div style="color: #666; font-size: 10px; text-transform: uppercase; margin-bottom: 4px;">Transport Encryption</div>
                                <div style="font-size: 14px; font-weight: bold; color: #00ff41">\${data.smtp_tls?.version || 'TLS 1.3'}</div>
                            </td>
                        </tr>
                        <tr>
                            <td style="width: 50%; background-color: #111; border: 1px solid #222; padding: 12px; vertical-align: top;">
                                <div style="color: #666; font-size: 10px; text-transform: uppercase; margin-bottom: 4px;">TLS Reporting (RPT)</div>
                                <div style="font-size: 14px; font-weight: bold; color: \${getStatusClass(dns.tls_rpt) === 'pass' ? '#00ff41' : '#ff0055'}">\${String(dns.tls_rpt || 'MISSING').toUpperCase()}</div>
                            </td>
                            <td style="width: 50%; background-color: #111; border: 1px solid #222; padding: 12px; vertical-align: top;">
                                <div style="color: #666; font-size: 10px; text-transform: uppercase; margin-bottom: 4px;">Brand Indicator (BIMI)</div>
                                <div style="font-size: 14px; font-weight: bold; color: \${getStatusClass(dns.bimi) === 'pass' ? '#00ff41' : '#ff0055'}">\${String(dns.bimi || 'MISSING').toUpperCase()}</div>
                            </td>
                        </tr>
                    </table>

                    <div style="background-color: rgba(0,255,65,0.05); border: 1px solid #00ff41; padding: 20px; margin-top: 40px; text-align: center;">
                        <div style="color: #00ff41; font-size: 18px; font-weight: bold; margin-bottom: 8px;">FORENSIC DIAGNOSTIC REQUIRED</div>
                        <p style="margin: 0; color: #ccc; font-size: 13px;">Our backend identified RFC violations and policy gaps.</p>
                        <p style="margin: 10px 0 0; color: #fff; font-weight: bold; font-size: 14px;">consult@nine-security.com</p>
                    </div>

                    <div style="margin-top: 60px; text-align: center; color: #444; font-size: 10px; border-top: 1px solid #222; padding-top: 20px; background-color: #0a0a0a;">
                        CONFIDENTIAL - CUSTODIAN: NINE-SECURITY.INC CLUSTER<br>
                        &copy; 2026 Nine-Security Team. All Systems Operational.
                    </div>
                </div>
            `;

            const container = document.getElementById('test-area');
            container.innerHTML = reportHtml;

            // Generate PDF
            const opt = {
                margin: 0,
                filename: 'test_report.pdf',
                image: { type: 'jpeg', quality: 1.0 },
                html2canvas: { scale: 2, useCORS: true, backgroundColor: '#0a0a0a' },
                jsPDF: { unit: 'pt', format: 'a4', orientation: 'portrait' },
                pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
            };

            // Just for visual check, we can see the container content now.
            console.log("Visual layout generated in #test-area");
        });
    </script>
</body>

</html>